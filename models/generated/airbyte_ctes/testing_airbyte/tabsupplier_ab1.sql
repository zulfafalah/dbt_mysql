{{ config(
    unique_key = '_airbyte_ab_id',
    schema = "_airbyte_testing_airbyte",
    tags = [ "top-level-intermediate" ]
) }}
-- SQL model to parse JSON blob stored in a single column and extract into separated field columns as described by the JSON Schema
-- depends_on: {{ source('testing_airbyte', '_airbyte_raw_tabsupplier') }}
select
    {{ json_extract_scalar('_airbyte_data', ['fax'], ['fax']) }} as fax,
    {{ json_extract_scalar('_airbyte_data', ['idx'], ['idx']) }} as idx,
    {{ json_extract_scalar('_airbyte_data', ['top'], ['top']) }} as top,
    {{ json_extract_scalar('_airbyte_data', ['bank'], ['bank']) }} as bank,
    {{ json_extract_scalar('_airbyte_data', ['city'], ['city']) }} as city,
    {{ json_extract_scalar('_airbyte_data', ['name'], ['name']) }} as {{ adapter.quote('name') }},
    {{ json_extract_scalar('_airbyte_data', ['npwp'], ['npwp']) }} as npwp,
    {{ json_extract_scalar('_airbyte_data', ['name1'], ['name1']) }} as name1,
    {{ json_extract_scalar('_airbyte_data', ['owner'], ['owner']) }} as {{ adapter.quote('owner') }},
    {{ json_extract_scalar('_airbyte_data', ['margin'], ['margin']) }} as margin,
    {{ json_extract_scalar('_airbyte_data', ['parent'], ['parent']) }} as parent,
    {{ json_extract_scalar('_airbyte_data', ['top_dn'], ['top_dn']) }} as top_dn,
    {{ json_extract_scalar('_airbyte_data', ['_assign'], ['_assign']) }} as _assign,
    {{ json_extract_scalar('_airbyte_data', ['country'], ['country']) }} as country,
    {{ json_extract_scalar('_airbyte_data', ['top_prn'], ['top_prn']) }} as top_prn,
    {{ json_extract_scalar('_airbyte_data', ['creation'], ['creation']) }} as creation,
    {{ json_extract_scalar('_airbyte_data', ['currency'], ['currency']) }} as currency,
    {{ json_extract_scalar('_airbyte_data', ['discount'], ['discount']) }} as discount,
    {{ json_extract_scalar('_airbyte_data', ['modified'], ['modified']) }} as modified,
    {{ json_extract_scalar('_airbyte_data', ['phone_no'], ['phone_no']) }} as phone_no,
    {{ json_extract_scalar('_airbyte_data', ['pic_name'], ['pic_name']) }} as pic_name,
    {{ json_extract_scalar('_airbyte_data', ['zip_code'], ['zip_code']) }} as zip_code,
    {{ json_extract_scalar('_airbyte_data', ['_comments'], ['_comments']) }} as _comments,
    {{ json_extract_scalar('_airbyte_data', ['_liked_by'], ['_liked_by']) }} as _liked_by,
    {{ json_extract_scalar('_airbyte_data', ['address_1'], ['address_1']) }} as address_1,
    {{ json_extract_scalar('_airbyte_data', ['address_2'], ['address_2']) }} as address_2,
    {{ json_extract_scalar('_airbyte_data', ['city_name'], ['city_name']) }} as city_name,
    {{ json_extract_scalar('_airbyte_data', ['docstatus'], ['docstatus']) }} as docstatus,
    {{ json_extract_scalar('_airbyte_data', ['incentive'], ['incentive']) }} as incentive,
    {{ json_extract_scalar('_airbyte_data', ['is_active'], ['is_active']) }} as is_active,
    {{ json_extract_scalar('_airbyte_data', ['npwp_date'], ['npwp_date']) }} as npwp_date,
    {{ json_extract_scalar('_airbyte_data', ['_user_tags'], ['_user_tags']) }} as _user_tags,
    {{ json_extract_scalar('_airbyte_data', ['parenttype'], ['parenttype']) }} as parenttype,
    {{ json_extract_scalar('_airbyte_data', ['_ab_cdc_lsn'], ['_ab_cdc_lsn']) }} as _ab_cdc_lsn,
    {{ json_extract_scalar('_airbyte_data', ['bank_issuer'], ['bank_issuer']) }} as bank_issuer,
    {{ json_extract_scalar('_airbyte_data', ['modified_by'], ['modified_by']) }} as modified_by,
    {{ json_extract_scalar('_airbyte_data', ['parentfield'], ['parentfield']) }} as parentfield,
    {{ json_extract_scalar('_airbyte_data', ['amended_from'], ['amended_from']) }} as amended_from,
    {{ json_extract_scalar('_airbyte_data', ['credit_limit'], ['credit_limit']) }} as credit_limit,
    {{ json_extract_scalar('_airbyte_data', ['pic_position'], ['pic_position']) }} as pic_position,
    {{ json_extract_scalar('_airbyte_data', ['sub_category'], ['sub_category']) }} as sub_category,
    {{ json_extract_scalar('_airbyte_data', ['discount_type'], ['discount_type']) }} as discount_type,
    {{ json_extract_scalar('_airbyte_data', ['naming_series'], ['naming_series']) }} as naming_series,
    {{ json_extract_scalar('_airbyte_data', ['supplier_bank'], ['supplier_bank']) }} as supplier_bank,
    {{ json_extract_scalar('_airbyte_data', ['supplier_code'], ['supplier_code']) }} as supplier_code,
    {{ json_extract_scalar('_airbyte_data', ['supplier_name'], ['supplier_name']) }} as supplier_name,
    {{ json_extract_scalar('_airbyte_data', ['address_npwp_1'], ['address_npwp_1']) }} as address_npwp_1,
    {{ json_extract_scalar('_airbyte_data', ['address_npwp_2'], ['address_npwp_2']) }} as address_npwp_2,
    {{ json_extract_scalar('_airbyte_data', ['bank_guarantee'], ['bank_guarantee']) }} as bank_guarantee,
    {{ json_extract_scalar('_airbyte_data', ['warranty_amount'], ['warranty_amount']) }} as warranty_amount,
    {{ json_extract_scalar('_airbyte_data', ['sub_category_name'], ['sub_category_name']) }} as sub_category_name,
    {{ json_extract_scalar('_airbyte_data', ['supplier_top_days'], ['supplier_top_days']) }} as supplier_top_days,
    {{ json_extract_scalar('_airbyte_data', ['warranty_currency'], ['warranty_currency']) }} as warranty_currency,
    {{ json_extract_scalar('_airbyte_data', ['_ab_cdc_deleted_at'], ['_ab_cdc_deleted_at']) }} as _ab_cdc_deleted_at,
    {{ json_extract_scalar('_airbyte_data', ['_ab_cdc_updated_at'], ['_ab_cdc_updated_at']) }} as _ab_cdc_updated_at,
    {{ json_extract_scalar('_airbyte_data', ['supplier_dn_top_days'], ['supplier_dn_top_days']) }} as supplier_dn_top_days,
    {{ json_extract_scalar('_airbyte_data', ['warranty_bank_issuer'], ['warranty_bank_issuer']) }} as warranty_bank_issuer,
    {{ json_extract_scalar('_airbyte_data', ['supplier_issuing_bank'], ['supplier_issuing_bank']) }} as supplier_issuing_bank,
    {{ json_extract_scalar('_airbyte_data', ['supplier_sub_category'], ['supplier_sub_category']) }} as supplier_sub_category,
    {{ json_extract_scalar('_airbyte_data', ['supplier_bank_guarantee'], ['supplier_bank_guarantee']) }} as supplier_bank_guarantee,
    {{ json_extract_scalar('_airbyte_data', ['supplier_sub_category_name'], ['supplier_sub_category_name']) }} as supplier_sub_category_name,
    _airbyte_ab_id,
    _airbyte_emitted_at,
    {{ current_timestamp() }} as _airbyte_normalized_at
from {{ source('testing_airbyte', '_airbyte_raw_tabsupplier') }} as table_alias
-- tabsupplier
where 1 = 1

